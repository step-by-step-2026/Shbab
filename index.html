<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق رصيدي - المساعد الذكي</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        // This is where you would import/use RecaptchaVerifier
        
        const firebaseConfig = {
            apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
            authDomain: "tourguideapp-313c1.firebaseapp.com",
            databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
            projectId: "tourguideapp-313c1",
            storageBucket: "tourguideapp-313c1.firebasestorage.app",
            messagingSenderId: "1036127588385",
            appId: "1:1036127588385:web:4924705000167b06395360"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        window.firebaseAuth = auth;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseApp = app; // Expose app for RecaptchaVerifier
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f3f4f6;
        }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .network-gradient-vodafone { background: linear-gradient(135deg, #e60000 0%, #b30000 100%); }
        .network-gradient-etisalat { background: linear-gradient(135deg, #95c11f 0%, #1e5a2d 100%); }
        .network-gradient-orange { background: linear-gradient(135deg, #ff7900 0%, #cc6000 100%); }
        .network-gradient-we { background: linear-gradient(135deg, #5c2d91 0%, #3e1e61 100%); }
        
        .tab-active { color: white; background-color: rgba(255,255,255,0.2); }
        /* Simple CAPTCHA placeholder style */
        .captcha-placeholder {
            border: 2px dashed #9ca3af;
            background-color: #f9fafb;
            color: #4b5563;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Data & Constants ---
        const NETWORKS = {
            vodafone: {
                id: 'vodafone',
                name: 'فودافون',
                colorClass: 'network-gradient-vodafone',
                textColor: 'text-red-600',
                bgColor: 'bg-red-500',
                codes: {
                    recharge: '*858*CODE#',
                    balance: '*868*1#',
                    cashTransfer: '*9*7*NUMBER*AMOUNT#',
                    cashBalance: '*9*13#',
                    internet: '*2000#',
                    service: '888'
                }
            },
            etisalat: {
                id: 'etisalat',
                name: 'اتصالات',
                colorClass: 'network-gradient-etisalat',
                textColor: 'text-green-600',
                bgColor: 'bg-green-500',
                codes: {
                    recharge: '*555*CODE#',
                    balance: '*888#',
                    cashTransfer: '*777*1*NUMBER*AMOUNT#', 
                    cashBalance: '*777*3#',
                    internet: '*566#',
                    service: '333'
                }
            },
            orange: {
                id: 'orange',
                name: 'أورنج',
                colorClass: 'network-gradient-orange',
                textColor: 'text-orange-600',
                bgColor: 'bg-orange-500',
                codes: {
                    recharge: '*102*CODE#',
                    balance: '*100#',
                    cashTransfer: '#115#', 
                    cashBalance: '#115#',
                    internet: '#100*4#',
                    service: '110'
                }
            },
            we: {
                id: 'we',
                name: 'وي',
                colorClass: 'network-gradient-we',
                textColor: 'text-purple-600',
                bgColor: 'bg-purple-900',
                codes: {
                    recharge: '*555*CODE#',
                    balance: '*550#',
                    cashTransfer: '*322#',
                    cashBalance: '*322#',
                    internet: '*999#',
                    service: '111'
                }
            }
        };

        // --- COMMON CODES (The "Al-Areef" data) ---
        const COMMON_CODES = {
            vodafone: [
                { title: 'معرفة الرقم', code: '*878#' },
                { title: 'باقات النت', code: '*2000#' },
                { title: 'خدمة سلفني شكراً', code: '*3#' },
                { title: 'تحويل رصيد', code: '*868*2*Num*Amt#' },
                { title: 'إلغاء الكول تون', code: '*055*0#' },
                { title: 'تجديد الباقة (فليكس)', code: '*225#' },
                { title: 'خدمة كلمني شكراً', code: '*505*NUMBER#' },
                { title: 'خدمة حظر المكالمات', code: '*7#' },
            ],
            etisalat: [
                { title: 'معرفة الرقم', code: '*947#' },
                { title: 'باقات النت', code: '*566#' },
                { title: 'خدمة سلفني', code: '*911#' },
                { title: 'نظام حكاية', code: '*319#' },
                { title: 'إلغاء الخدمات الترفيهية', code: '*166#' },
                { title: 'تحويل الرصيد', code: '*557*NUM*AMT#' },
                { title: 'خدمة الكول تون', code: '1500' },
                { title: 'خدمة انتظار المكالمات', code: '*43#' },
            ],
            orange: [
                { title: 'معرفة الرقم', code: '#119#' },
                { title: 'باقات النت', code: '#100*4#' },
                { title: 'خدمة سلفني شكراً', code: '#100*2#' },
                { title: 'خدمات شكراً', code: '#121#' },
                { title: 'تحويل رصيد', code: '#100# ثم 2' },
                { title: 'معرفة إجمالي الاستهلاك', code: '#0#' },
                { title: 'نظام الكارت', code: '400' },
                { title: 'إلغاء خاصية إيزي نت', code: '399' },
            ],
            we: [
                { title: 'معرفة الرقم', code: '*688#' },
                { title: 'باقات النت (التحكم)', code: '*999#' },
                { title: 'خدمة سلفني', code: '*504#' },
                { title: 'العروض اليومية', code: '*015#' },
                { title: 'تحويل الرصيد', code: '*551*NUM*AMT#' },
                { title: 'التحكم في الخط', code: '111 أو 01555000111' },
                { title: 'معرفة المتبقي من الباقة', code: '*414#' },
                { title: 'إلغاء الخدمات الترفيهية', code: '*155#' },
            ]
        };

        // --- Shared Components ---
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);
            
            return (
                <div className="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-50 animate-bounce">
                    {message}
                </div>
            );
        };

        const ActionButton = ({ icon, label, onClick, colorClass }) => (
            <button 
                onClick={onClick}
                className={`flex flex-col items-center justify-center p-4 bg-white rounded-xl shadow-sm active:scale-95 transition-transform duration-200 border border-gray-100 w-full`}
            >
                <div className={`p-3 rounded-full ${colorClass} bg-opacity-10 mb-2`}>
                    <i data-lucide={icon} className={`w-6 h-6 ${colorClass.replace('bg-', 'text-').replace('10', '600')}`}></i>
                </div>
                <span className="text-sm font-semibold text-gray-700">{label}</span>
            </button>
        );
        
        // Login Screen Component (with CAPTCHA/Verifier Placeholder)
        const LoginScreen = ({ onLogin }) => {
            const [phoneNumber, setPhoneNumber] = useState('');
            const [otpCode, setOtpCode] = useState('');
            const [step, setStep] = useState(1); // 1: Phone, 2: OTP
            
            // Placeholder for RecaptchaVerifier
            const recaptchaRef = useRef(null);
            
            const handleSendOtp = () => {
                if (phoneNumber.length < 11) return alert('يرجى إدخال رقم هاتف صحيح');
                
                // --- Real Implementation with Firebase RecaptchaVerifier would go here ---
                // For a real app, you would initialize RecaptchaVerifier on `recaptchaRef.current`
                // and then call signInWithPhoneNumber.
                
                // DEMO FLOW
                setStep(2); 
            };
            
            const handleVerifyOtp = () => {
                if (otpCode.length !== 6) return alert('يرجى إدخال كود صحيح');
                // --- Real OTP Verification would go here ---
                
                // DEMO FLOW
                onLogin({ phoneNumber: phoneNumber, uid: 'demo' });
            };

            // CAPTCHA Placeholder
            useEffect(() => {
                if (step === 1) {
                    // Initialize RecaptchaVerifier here in a real app
                    // This div is needed for Firebase to inject the reCAPTCHA widget
                    // if (window.firebaseApp) {
                    //     window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(recaptchaRef.current, {
                    //          'size': 'invisible' or 'normal',
                    //          // ... other settings
                    //     }, window.firebaseApp);
                    //     window.recaptchaVerifier.render();
                    // }
                }
            }, [step]);
            
            return (
                 <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-white">
                     <div className="text-center p-10 bg-gray-50 rounded-xl shadow-lg w-full max-w-sm">
                        <h2 className="text-2xl font-bold text-gray-900 mb-4">تسجيل الدخول</h2>
                        <p className="text-gray-600 mb-6">يرجى إدخال رقم الهاتف لإرسال كود التحقق.</p>
                        
                        {step === 1 && (
                            <div className="space-y-4">
                                <input 
                                    type="tel" 
                                    value={phoneNumber}
                                    onChange={(e) => setPhoneNumber(e.target.value)}
                                    className="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 focus:ring-blue-500 focus:border-blue-500 outline-none"
                                    placeholder="01xxxxxxxxx"
                                />
                                
                                {/* CAPTCHA Verifier Placeholder */}
                                <div ref={recaptchaRef} id="recaptcha-container" className="captcha-placeholder p-3 rounded-lg text-sm text-center">
                                    <i data-lucide="shield-check" className="w-5 h-5 inline-block mx-2"></i>
                                    مكان التحقق من أنك لست روبوت (CAPTCHA)
                                </div>
                                
                                <button 
                                    onClick={handleSendOtp}
                                    className="w-full py-3 px-6 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition duration-200"
                                >
                                    إرسال كود التحقق
                                </button>
                                <button 
                                    onClick={() => onLogin({ phoneNumber: '01000000000 (تجريبي)', uid: 'demo' })}
                                    className="w-full text-blue-600 font-bold hover:underline mt-2"
                                >
                                    الدخول بوضع تجريبي
                                </button>
                            </div>
                        )}
                        
                        {step === 2 && (
                            <div className="space-y-4">
                                <p className="text-sm text-green-600">تم إرسال الكود إلى {phoneNumber}.</p>
                                <input 
                                    type="number" 
                                    value={otpCode}
                                    onChange={(e) => setOtpCode(e.target.value)}
                                    className="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-center focus:ring-blue-500 focus:border-blue-500 outline-none"
                                    placeholder="أدخل كود التحقق"
                                />
                                <button 
                                    onClick={handleVerifyOtp}
                                    className="w-full py-3 px-6 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition duration-200"
                                >
                                    تحقق الآن
                                </button>
                                <button onClick={() => setStep(1)} className="w-full text-gray-500 hover:underline mt-2">
                                    تغيير الرقم
                                </button>
                            </div>
                        )}
                    </div>
                 </div>
            );
        };


        // --- Main App Component ---
        const App = () => {
            const [user, setUser] = useState(null); // Start with null to show LoginScreen
            const [loading, setLoading] = useState(false); 
            
            const [selectedNetwork, setSelectedNetwork] = useState(NETWORKS.vodafone);
            const [activeTab, setActiveTab] = useState('home');
            const [toast, setToast] = useState(null);
            
            // App States
            const [cardCode, setCardCode] = useState('');
            const [cashPhone, setCashPhone] = useState('');
            const [cashAmount, setCashAmount] = useState('');
            
            // Usage Monitor State (Simplified Firewall Placeholder)
            const [dataLimit, setDataLimit] = useState(2000); // MB
            const [dataUsed, setDataUsed] = useState(0);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
                // Check if user data exists (if we want persistence)
                const storedUser = localStorage.getItem('rasidy_demo_user');
                if (storedUser) {
                    setUser(JSON.parse(storedUser));
                }
            }, []);

            useEffect(() => {
                 if (window.lucide) window.lucide.createIcons();
            }, [activeTab, selectedNetwork, user]);

            const showToast = (msg) => setToast(msg);

            // --- Handlers ---
            const handleNetworkChange = (networkId) => {
                setSelectedNetwork(NETWORKS[networkId]);
                setCardCode('');
                setCashPhone('');
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('تم نسخ الكود بنجاح!');
                }).catch(err => {
                    showToast('فشل النسخ، يرجى النسخ يدوياً.');
                    console.error('Could not copy text: ', err);
                });
            };

            const dialCode = (code) => {
                const encodedCode = code.replace(/#/g, '%23').replace(/\*/g, '%2A');
                window.location.href = `tel:${encodedCode}`;
            };

            // --- Logic Generators ---
            const generateRechargeCode = (type) => {
                if (!cardCode) {
                    showToast('يرجى إدخال رقم الكارت أولاً.');
                    return;
                }
                let finalCode = selectedNetwork.codes.recharge.replace('CODE', cardCode);
                
                // Specific logic for "Net Only"
                if (type === 'net' && selectedNetwork.id === 'vodafone') {
                    finalCode = `*858*${cardCode}*9#`; 
                } else if (type === 'net' && selectedNetwork.id === 'we') {
                    finalCode = `*555*${cardCode}*2#`;
                }
                
                dialCode(finalCode);
                showToast(`تم تحويلك إلى لوحة الاتصال. اضغط "اتصال" لتنفيذ الشحن.`);
            };

            const generateCashTransfer = () => {
                if (!cashPhone || !cashAmount) {
                    showToast('يرجى إدخال الرقم والمبلغ أولاً.');
                    return;
                }
                let pattern = selectedNetwork.codes.cashTransfer;
                if (pattern.includes('NUMBER')) {
                    pattern = pattern.replace('NUMBER', cashPhone).replace('AMOUNT', cashAmount);
                    dialCode(pattern);
                    showToast(`تم تحويلك إلى لوحة الاتصال. اضغط "اتصال" للمتابعة.`);
                } else {
                    dialCode(pattern);
                    showToast('تم تحويلك. يرجى إدخال الرقم والمبلغ يدوياً في القائمة.');
                }
            };
            
            // Logout Function
            const handleLogout = () => {
                // In a real app: window.firebaseSignOut(window.firebaseAuth);
                localStorage.removeItem('rasidy_demo_user');
                setUser(null);
            };
            
            const handleLoginSuccess = (userData) => {
                 localStorage.setItem('rasidy_demo_user', JSON.stringify(userData));
                 setUser(userData);
            };

            // --- Render Screens ---
            
            if (loading) return (
                <div className="flex items-center justify-center h-screen bg-gray-100">
                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                </div>
            );

            // If user is null, show login screen
            if (!user) return <LoginScreen onLogin={handleLoginSuccess} />;

            // --- Main App Interface ---
            return (
                <div className="min-h-screen pb-20 max-w-md mx-auto bg-gray-50 shadow-2xl overflow-hidden relative">
                    
                    {/* Header with Network Selector */}
                    <div className={`${selectedNetwork.colorClass} text-white p-6 rounded-b-3xl shadow-lg transition-colors duration-500`}>
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-xl font-bold">أهلاً بك</h1>
                                <p className="text-sm opacity-90">{user.phoneNumber || 'مستخدم مميز'}</p>
                            </div>
                            <button onClick={handleLogout} className="bg-white/20 p-2 rounded-full hover:bg-white/30">
                                <i data-lucide="log-out" className="w-5 h-5"></i>
                            </button>
                        </div>

                        {/* Network Switcher */}
                        <div className="flex justify-between bg-white/20 p-1 rounded-xl backdrop-blur-sm">
                            {Object.values(NETWORKS).map(net => (
                                <button
                                    key={net.id}
                                    onClick={() => handleNetworkChange(net.id)}
                                    className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-300 ${selectedNetwork.id === net.id ? 'bg-white ' + net.textColor : 'text-white hover:bg-white/10'}`}
                                >
                                    {net.name}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content Area */}
                    <div className="p-4 space-y-6">
                        
                        {/* 1. HOME TAB: Recharge & Quick Actions */}
                        {activeTab === 'home' && (
                            <div className="space-y-6 animate-fadeIn">
                                {/* Recharge Card */}
                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                                    <div className="flex items-center gap-2 mb-4">
                                        <i data-lucide="zap" className={`w-5 h-5 ${selectedNetwork.textColor}`}></i>
                                        <h3 className="font-bold text-gray-800">شحن كارت سريع</h3>
                                    </div>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            value={cardCode}
                                            onChange={(e) => setCardCode(e.target.value)}
                                            placeholder="اكتب الـ 14 رقم للكارت"
                                            className="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 pl-10 focus:ring-2 focus:ring-opacity-50 outline-none transition-all"
                                        />
                                        <i data-lucide="credit-card" className="absolute left-3 top-3.5 text-gray-400 w-5 h-5"></i>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-3 mt-4">
                                        <button onClick={() => generateRechargeCode('mix')} className={`${selectedNetwork.bgColor} text-white py-3 rounded-xl font-bold shadow-md hover:opacity-90 active:scale-95 transition`}>
                                            شحن رصيد/ميكس
                                        </button>
                                        <button onClick={() => generateRechargeCode('net')} className="bg-gray-800 text-white py-3 rounded-xl font-bold shadow-md hover:bg-gray-700 active:scale-95 transition">
                                            شحن إنترنت فقط
                                        </button>
                                    </div>
                                </div>

                                {/* Quick Services Grid */}
                                <div className="grid grid-cols-3 gap-3">
                                    <ActionButton 
                                        icon="smartphone" 
                                        label="استعلام رصيد" 
                                        colorClass={selectedNetwork.textColor} 
                                        onClick={() => { 
                                            dialCode(selectedNetwork.codes.balance);
                                            showToast('تم تحويلك للاستعلام. الرسالة ستظهر بعد الاتصال.');
                                        }} 
                                    />
                                    <ActionButton 
                                        icon="wifi" 
                                        label="باقات النت" 
                                        colorClass="text-blue-600" 
                                        onClick={() => dialCode(selectedNetwork.codes.internet)} 
                                    />
                                    <ActionButton 
                                        icon="headphones" 
                                        label="خدمة العملاء" 
                                        colorClass="text-gray-600" 
                                        onClick={() => dialCode(selectedNetwork.codes.service)} 
                                    />
                                </div>
                            </div>
                        )}

                        {/* 2. CASH TAB */}
                        {activeTab === 'cash' && (
                            <div className="space-y-6 animate-fadeIn">
                                <div className="bg-gradient-to-br from-gray-900 to-gray-800 text-white p-6 rounded-2xl shadow-xl">
                                    <div className="flex justify-between items-start mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold">محفظة الكاش</h2>
                                            <p className="text-gray-400 text-sm mt-1">{selectedNetwork.name} كاش</p>
                                        </div>
                                        <div className="bg-white/10 p-2 rounded-lg">
                                            <i data-lucide="wallet" className="w-8 h-8 text-yellow-400"></i>
                                        </div>
                                    </div>

                                    <button 
                                        onClick={() => {
                                            dialCode(selectedNetwork.codes.cashBalance);
                                            showToast('تم تحويلك للاستعلام عن رصيد المحفظة. الرسالة ستظهر بعد الاتصال.');
                                        }}
                                        className="w-full bg-white/10 hover:bg-white/20 border border-white/20 text-white py-3 rounded-xl flex items-center justify-center gap-2 transition"
                                    >
                                        <i data-lucide="eye" className="w-4 h-4"></i>
                                        استعلام عن رصيد المحفظة
                                    </button>
                                </div>

                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                                    <h3 className="font-bold text-gray-800 mb-4 border-b pb-2">تحويل أموال</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="text-xs font-bold text-gray-500 mb-1 block">رقم المحول إليه</label>
                                            <div className="relative">
                                                <input 
                                                    type="tel" 
                                                    value={cashPhone}
                                                    onChange={(e) => setCashPhone(e.target.value)}
                                                    className="w-full bg-gray-50 rounded-xl px-4 py-3 pl-10 border focus:border-blue-500 outline-none"
                                                    placeholder="01xxxxxxxxx"
                                                />
                                                <i data-lucide="phone" className="absolute left-3 top-3.5 text-gray-400 w-4 h-4"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-gray-500 mb-1 block">المبلغ (جنيه)</label>
                                            <div className="relative">
                                                <input 
                                                    type="number" 
                                                    value={cashAmount}
                                                    onChange={(e) => setCashAmount(e.target.value)}
                                                    className="w-full bg-gray-50 rounded-xl px-4 py-3 pl-10 border focus:border-blue-500 outline-none"
                                                    placeholder="مثلاً 100"
                                                />
                                                <i data-lucide="coins" className="absolute left-3 top-3.5 text-gray-400 w-4 h-4"></i>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={generateCashTransfer}
                                            className={`w-full ${selectedNetwork.bgColor} text-white py-3 rounded-xl font-bold shadow-lg hover:brightness-110 transition flex items-center justify-center gap-2`}
                                        >
                                            <i data-lucide="send" className="w-4 h-4"></i>
                                            تحويل الآن
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* 3. AL-AREEF TAB (Codes) */}
                        {activeTab === 'areef' && (
                            <div className="animate-fadeIn space-y-4">
                                <div className="bg-blue-50 border border-blue-100 p-4 rounded-xl flex items-center gap-3">
                                    <i data-lucide="book-open" className="text-blue-600 w-6 h-6"></i>
                                    <div>
                                        <h3 className="font-bold text-blue-900">العريف</h3>
                                        <p className="text-xs text-blue-700">دليل الأكواد المختصرة الشامل لشبكة {selectedNetwork.name}</p>
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    {COMMON_CODES[selectedNetwork.id].map((item, idx) => (
                                        <div key={idx} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center group hover:border-blue-200 transition">
                                            <div>
                                                <h4 className="font-bold text-gray-800">{item.title}</h4>
                                                <p className="text-sm text-gray-500 font-mono mt-1 dir-ltr">{item.code}</p>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => copyToClipboard(item.code)} className="p-2 bg-gray-100 rounded-lg text-gray-600 hover:bg-gray-200" title="نسخ">
                                                    <i data-lucide="copy" className="w-4 h-4"></i>
                                                </button>
                                                <button onClick={() => dialCode(item.code)} className={`p-2 ${selectedNetwork.bgColor} bg-opacity-10 rounded-lg ${selectedNetwork.textColor} hover:bg-opacity-20`} title="اتصال">
                                                    <i data-lucide="phone" className="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* 4. USAGE / FIREWALL TAB */}
                        {activeTab === 'usage' && (
                            <div className="animate-fadeIn space-y-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 text-center">
                                    <h3 className="text-lg font-bold text-gray-800 mb-2">مراقب الاستهلاك</h3>
                                    <p className="text-xs text-red-500 font-bold mb-4 border-b pb-3">تنبيه: خاصية حظر التطبيقات تتطلب أذونات نظام التشغيل ولا تعمل في تطبيق الويب. هذه أداة حسابية مساعدة فقط.</p>
                                    
                                    <div className="relative w-40 h-40 mx-auto mb-6 flex items-center justify-center">
                                        <svg className="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                            <path className="text-gray-200" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="3" />
                                            <path className={`${selectedNetwork.textColor}`} strokeDasharray={`${(dataUsed/dataLimit)*100}, 100`} d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" strokeWidth="3" />
                                        </svg>
                                        <div className="absolute flex flex-col items-center">
                                            <span className="text-2xl font-bold text-gray-800">{dataLimit - dataUsed}</span>
                                            <span className="text-xs text-gray-500">ميجابايت متبقية</span>
                                            {dataUsed > dataLimit && <span className="text-red-500 font-bold text-xs mt-1">تجاوزت الباقة!</span>}
                                        </div>
                                    </div>

                                    <div className="flex justify-between items-center bg-gray-50 p-3 rounded-lg mb-4">
                                        <span className="text-sm font-bold text-gray-600">حدد حجم الباقة (ميجابايت):</span>
                                        <input 
                                            type="number" 
                                            value={dataLimit} 
                                            onChange={(e) => setDataLimit(parseInt(e.target.value) || 0)}
                                            className="w-24 bg-white border rounded px-2 py-1 text-center outline-none focus:ring-1"
                                            min="0"
                                        />
                                    </div>

                                    <div className="space-y-2">
                                        <p className="text-xs font-bold text-left text-gray-500">إضافة استهلاك افتراضي (محاكاة الحظر):</p>
                                        <div className="grid grid-cols-3 gap-2">
                                            <button onClick={() => setDataUsed(d => d + 150)} className="bg-blue-50 text-blue-600 py-2 rounded-lg text-xs font-bold">+150MB (فيديو)</button>
                                            <button onClick={() => setDataUsed(d => d + 20)} className="bg-green-50 text-green-600 py-2 rounded-lg text-xs font-bold">+20MB (تصفح)</button>
                                            <button onClick={() => setDataUsed(0)} className="bg-red-50 text-red-600 py-2 rounded-lg text-xs font-bold">تصفير العداد</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                    </div>

                    {/* Bottom Navigation */}
                    <div className="fixed bottom-0 w-full max-w-md bg-white border-t border-gray-200 pb-safe shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
                        <div className="flex justify-around items-center p-2">
                            <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'home' ? selectedNetwork.textColor : 'text-gray-400'}`}>
                                <i data-lucide="home" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">الرئيسية</span>
                            </button>
                            <button onClick={() => setActiveTab('cash')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'cash' ? selectedNetwork.textColor : 'text-gray-400'}`}>
                                <i data-lucide="wallet" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">الكاش</span>
                            </button>
                            <button onClick={() => setActiveTab('areef')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'areef' ? selectedNetwork.textColor : 'text-gray-400'}`}>
                                <i data-lucide="book-open" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">العريف</span>
                            </button>
                            <button onClick={() => setActiveTab('usage')} className={`flex flex-col items-center p-2 rounded-xl transition ${activeTab === 'usage' ? selectedNetwork.textColor : 'text-gray-400'}`}>
                                <i data-lucide="pie-chart" className="w-6 h-6"></i>
                                <span className="text-[10px] font-bold mt-1">استهلاك</span>
                            </button>
                        </div>
                    </div>
                    {toast && <Toast message={toast} onClose={() => setToast(null)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
